// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

// ----------------------------------------------------
// ğŸ“Œ ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« (ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—)
// ----------------------------------------------------

// 1. æ€§åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ« (Genders_Table)
model Gender {
  code Int    @id @map("gender_code")
  name String @map("gender_name") @db.VarChar(20)

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  accounts Account[]

  @@map("Genders_Table")
}

// 2. å¹´é½¢å±¤ãƒ†ãƒ¼ãƒ–ãƒ« (Age_Table)
model AgeGroup {
  code Int    @id @map("age_group_code")
  name String @map("age_group_name") @db.VarChar(20)

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  accounts Account[]

  @@map("Age_Table")
}

// 3. è·æ¥­ãƒ†ãƒ¼ãƒ–ãƒ« (Occupations_Table)
model Occupation {
  code Int    @id @map("occupation_code")
  name String @map("occupation_name") @db.VarChar(50)

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  accounts Account[]

  @@map("Occupations_Table")
}

// ----------------------------------------------------
// ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼/å‡ºåº—è€…ãƒ†ãƒ¼ãƒ–ãƒ« (Accounts_Table)
// ----------------------------------------------------

// 4. åˆ©ç”¨è€…/å‡ºåº—è€…ãƒ†ãƒ¼ãƒ–ãƒ« (Accounts_Tableã¨ã—ã¦çµ±åˆ)
// account_type ('User' or 'Vendor') ã§åŒºåˆ¥
model Account {
  id            Int       @id @default(autoincrement()) @map("account_id")
  nickname      String    @unique @db.VarChar(50)
  accountType   String    @map("account_type") @db.VarChar(10) // åˆ©ç”¨è€…(User) or å‡ºåº—è€…(Vendor)
  storeName     String?   @map("store_name") @db.VarChar(100) // å‡ºåº—è€…å (Vendorã®ã¿)
  introduction  String?   @db.Text // è‡ªå·±ç´¹ä»‹/åº—èˆ—ç´¹ä»‹
  
  // å¤–éƒ¨ã‚­ãƒ¼
  genderCode    Int?      @map("gender_code")
  ageGroupCode  Int?      @map("age_group_code")
  occupationCode Int?     @map("occupation_code")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
  gender        Gender?    @relation(fields: [genderCode], references: [code])
  ageGroup      AgeGroup?  @relation(fields: [ageGroupCode], references: [code])
  occupation    Occupation? @relation(fields: [occupationCode], references: [code])
  
  // ä¾å­˜ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  locations     Location[]
  comments      Comment[]
  likes         Like[]

  @@map("Accounts_Table") // å…ƒã®å®šç¾©ã«ã¯ãªã„ãŒã€ç®¡ç†ã—ã‚„ã™ã„ã‚ˆã†ã«å‘½å
}

// ----------------------------------------------------
// ğŸ“ ä½ç½®æƒ…å ±ãƒ»æŠ•ç¨¿ãƒ»ã„ã„ã­ ãƒ†ãƒ¼ãƒ–ãƒ«
// ----------------------------------------------------

// 5. å‡ºåº—è€…ä½ç½®æƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ« (Locations_Table)
model Location {
  id            Int       @id @default(autoincrement()) @map("location_id")
  accountId     Int       @map("account_id") // å¤–éƒ¨ã‚­ãƒ¼

  latitude      Decimal     @db.Decimal(10, 8)
  longitude     Decimal     @db.Decimal(11, 8)
  openingDate   DateTime  @map("opening_date") @db.Date // å–¶æ¥­é–‹å§‹æ—¥
  locationName  String?   @map("location_name") @db.VarChar(100)

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
  account       Account   @relation(fields: [accountId], references: [id])
  
  @@map("Locations_Table")
}

// 6. ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ†ãƒ¼ãƒ–ãƒ« (Comments_Table)
model Comment {
  id            Int       @id @default(autoincrement()) @map("comment_id")
  accountId     Int       @map("account_id") // å¤–éƒ¨ã‚­ãƒ¼

  latitude      Decimal     @db.Decimal(10, 8)
  longitude     Decimal     @db.Decimal(11, 8)
  commentText   String    @map("comment_text") @db.Text
  postedAt      DateTime  @map("posted_at") @default(now()) // æŠ•ç¨¿æ—¥æ™‚

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
  account       Account   @relation(fields: [accountId], references: [id])
  likes         Like[] // ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã«ã¤ã„ãŸã€Œã„ã„ã­ã€

  @@map("Comments_Table")
}

// 7. ã„ã„ã­ãƒ†ãƒ¼ãƒ–ãƒ« (Likes_Table) - è¤‡åˆä¸»ã‚­ãƒ¼
model Like {
  commentId     Int       @map("comment_id") // å¤–éƒ¨ã‚­ãƒ¼
  accountId     Int       @map("account_id") // å¤–éƒ¨ã‚­ãƒ¼
  likedAt       DateTime  @map("liked_at") @default(now()) // ã„ã„ã­æ—¥æ™‚

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
  comment       Comment   @relation(fields: [commentId], references: [id])
  account       Account   @relation(fields: [accountId], references: [id])

  // è¤‡åˆä¸»ã‚­ãƒ¼ (ã‚³ãƒ¡ãƒ³ãƒˆIDã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã®çµ„ã¿åˆã‚ã›ã§ä¸€æ„)
  @@id([commentId, accountId])
  @@map("Likes_Table")
}